<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚è±Ô∏è Time Tracker ‚Äî B.AI Internship</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

  :root {
    --bg: #0f0f14;
    --surface: #1a1a24;
    --surface2: #22222e;
    --border: #2a2a3a;
    --text: #e8e8f0;
    --text-muted: #8888a0;
    --accent: #6366f1;
    --accent-light: #818cf8;
    --green: #34d399;
    --green-bg: rgba(52,211,153,0.12);
    --red: #f87171;
    --red-bg: rgba(248,113,113,0.12);
    --blue: #60a5fa;
    --blue-bg: rgba(96,165,250,0.12);
    --yellow: #fbbf24;
    --yellow-bg: rgba(251,191,36,0.12);
    --purple: #a78bfa;
    --purple-bg: rgba(167,139,250,0.12);
    --pink: #f472b6;
    --orange: #fb923c;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 24px;
  }

  .container { max-width: 1100px; margin: 0 auto; }

  /* Header */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
  }
  .header h1 {
    font-size: 28px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--accent-light), var(--purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .header .date {
    color: var(--text-muted);
    font-size: 14px;
  }

  /* Clock Section */
  .clock-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    margin-bottom: 24px;
    position: relative;
    overflow: hidden;
  }
  .clock-section::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle at 50% 50%, rgba(99,102,241,0.05), transparent 60%);
    pointer-events: none;
  }
  .clock-display {
    font-size: 64px;
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    letter-spacing: 2px;
    margin-bottom: 8px;
  }
  .clock-label {
    color: var(--text-muted);
    font-size: 14px;
    margin-bottom: 28px;
    text-transform: uppercase;
    letter-spacing: 2px;
  }
  .clock-btn {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    border: 3px solid var(--green);
    background: var(--green-bg);
    color: var(--green);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    position: relative;
    font-family: 'Inter', sans-serif;
  }
  .clock-btn .icon { font-size: 36px; }
  .clock-btn:hover {
    background: rgba(52,211,153,0.2);
    transform: scale(1.05);
    box-shadow: 0 0 40px rgba(52,211,153,0.15);
  }
  .clock-btn.active {
    border-color: var(--red);
    background: var(--red-bg);
    color: var(--red);
    animation: pulse 2s infinite;
  }
  .clock-btn.active:hover {
    background: rgba(248,113,113,0.2);
    box-shadow: 0 0 40px rgba(248,113,113,0.15);
  }
  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(248,113,113,0.3); }
    50% { box-shadow: 0 0 0 15px rgba(248,113,113,0); }
  }

  .session-info {
    margin-top: 24px;
    display: flex;
    gap: 32px;
    justify-content: center;
  }
  .session-info .item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }
  .session-info .label {
    color: var(--text-muted);
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .session-info .value {
    font-size: 18px;
    font-weight: 600;
  }

  /* Form Row */
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
    margin-bottom: 24px;
  }
  .form-group label {
    display: block;
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .form-group select, .form-group input {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    padding: 10px 14px;
    font-size: 14px;
    font-family: 'Inter', sans-serif;
    outline: none;
    transition: border-color 0.2s;
  }
  .form-group select:focus, .form-group input:focus {
    border-color: var(--accent);
  }

  /* Stats Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
  }
  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 20px;
  }
  .stat-card .stat-label {
    font-size: 12px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
  }
  .stat-card .stat-value {
    font-size: 28px;
    font-weight: 700;
  }
  .stat-card .stat-sub {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 4px;
  }

  /* Two columns */
  .two-cols {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 24px;
  }

  /* Chart */
  .chart-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 20px;
  }
  .chart-card h3 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 16px;
  }
  .bar-chart { display: flex; flex-direction: column; gap: 10px; }
  .bar-row {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .bar-label {
    width: 100px;
    font-size: 13px;
    color: var(--text-muted);
    text-align: right;
    flex-shrink: 0;
  }
  .bar-track {
    flex: 1;
    height: 28px;
    background: var(--surface2);
    border-radius: 6px;
    overflow: hidden;
    position: relative;
  }
  .bar-fill {
    height: 100%;
    border-radius: 6px;
    transition: width 0.8s ease;
    display: flex;
    align-items: center;
    padding-left: 10px;
    font-size: 12px;
    font-weight: 600;
    min-width: fit-content;
  }

  /* Log Table */
  .log-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 20px;
    margin-bottom: 24px;
  }
  .log-card h3 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .log-card h3 span {
    font-size: 12px;
    color: var(--text-muted);
    font-weight: 400;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th {
    text-align: left;
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 8px 12px;
    border-bottom: 1px solid var(--border);
  }
  td {
    padding: 12px;
    font-size: 13px;
    border-bottom: 1px solid rgba(42,42,58,0.5);
    vertical-align: middle;
  }
  tr:last-child td { border-bottom: none; }
  .tag {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
  }
  .tag-blue { background: var(--blue-bg); color: var(--blue); }
  .tag-purple { background: var(--purple-bg); color: var(--purple); }
  .tag-green { background: var(--green-bg); color: var(--green); }
  .tag-yellow { background: var(--yellow-bg); color: var(--yellow); }
  .tag-orange { background: rgba(251,146,60,0.12); color: var(--orange); }

  /* Weekly heatmap */
  .heatmap {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
    margin-top: 8px;
  }
  .heat-day {
    aspect-ratio: 1;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    gap: 2px;
    transition: transform 0.2s;
  }
  .heat-day:hover { transform: scale(1.1); }
  .heat-day .day-name { color: var(--text-muted); font-size: 10px; }
  .heat-day .day-hours { font-weight: 600; font-size: 16px; }

  .export-btn {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text-muted);
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 12px;
    cursor: pointer;
    font-family: 'Inter', sans-serif;
    transition: all 0.2s;
  }
  .export-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  @media (max-width: 768px) {
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .two-cols { grid-template-columns: 1fr; }
    .form-row { grid-template-columns: 1fr; }
    .clock-display { font-size: 42px; }
    .clock-btn { width: 140px; height: 140px; }
  }
</style>
</head>
<body>
<div class="container">

  <!-- Header -->
  <div class="header">
    <h1>‚è±Ô∏è Time Tracker</h1>
    <div class="date" id="currentDate"></div>
  </div>

  <!-- Clock In/Out -->
  <div class="clock-section">
    <div class="clock-display" id="clock">00:00:00</div>
    <div class="clock-label" id="clockLabel">Listo para fichar</div>
    <button class="clock-btn" id="clockBtn" onclick="toggleClock()">
      <span class="icon">&#9654;</span>
      <span id="btnText">FICHAR</span>
    </button>
    <div class="session-info" id="sessionInfo" style="display:none;">
      <div class="item">
        <span class="label">Inicio</span>
        <span class="value" id="sessionStart">‚Äî</span>
      </div>
      <div class="item">
        <span class="label">Duracion</span>
        <span class="value" id="sessionDuration">0h 0min</span>
      </div>
    </div>
  </div>

  <!-- Form -->
  <div class="form-row">
    <div class="form-group">
      <label>Proyecto</label>
      <select id="projectSelect">
        <option value="B.AI Internship">B.AI Internship</option>
        <option value="Master - BG">Master - BG</option>
        <option value="Coursera">Coursera</option>
        <option value="Anthropic">Anthropic</option>
        <option value="Otro">Otro</option>
      </select>
    </div>
    <div class="form-group">
      <label>Tipo de tarea</label>
      <select id="taskSelect">
        <option value="Desarrollo">üíª Desarrollo</option>
        <option value="Reunion">ü§ù Reunion</option>
        <option value="Investigacion">üîç Investigacion</option>
        <option value="Documentacion">üìù Documentacion</option>
        <option value="Formacion">üéì Formacion</option>
        <option value="Revision">üëÄ Revision</option>
        <option value="Otro">‚öôÔ∏è Otro</option>
      </select>
    </div>
    <div class="form-group">
      <label>Notas</label>
      <input type="text" id="notesInput" placeholder="Que hiciste hoy...">
    </div>
  </div>

  <!-- Stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">Hoy</div>
      <div class="stat-value" id="todayHours">0h</div>
      <div class="stat-sub" id="todaySessions">0 sesiones</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Esta semana</div>
      <div class="stat-value" id="weekHours">0h</div>
      <div class="stat-sub" id="weekSessions">0 sesiones</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Este mes</div>
      <div class="stat-value" id="monthHours">0h</div>
      <div class="stat-sub" id="monthSessions">0 sesiones</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Media diaria</div>
      <div class="stat-value" id="avgHours">0h</div>
      <div class="stat-sub">ultimos 7 dias</div>
    </div>
  </div>

  <!-- Charts -->
  <div class="two-cols">
    <div class="chart-card">
      <h3>Horas por proyecto</h3>
      <div class="bar-chart" id="projectChart"></div>
    </div>
    <div class="chart-card">
      <h3>Esta semana</h3>
      <div class="heatmap" id="weekHeatmap"></div>
    </div>
  </div>

  <!-- Log -->
  <div class="log-card">
    <h3>
      Registro reciente
      <button class="export-btn" onclick="exportCSV()">Exportar CSV</button>
    </h3>
    <table>
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>Duracion</th>
          <th>Proyecto</th>
          <th>Tarea</th>
          <th>Notas</th>
        </tr>
      </thead>
      <tbody id="logBody"></tbody>
    </table>
  </div>

</div>

<script>
  // State
  let isClocked = false;
  let clockStart = null;
  let timerInterval = null;
  let entries = JSON.parse(localStorage.getItem('timeEntries') || '[]');

  // Init
  function init() {
    updateDate();
    startRealClock();
    renderLog();
    renderStats();
    renderCharts();
    renderHeatmap();
    setInterval(updateDate, 60000);
  }

  function updateDate() {
    const now = new Date();
    document.getElementById('currentDate').textContent = now.toLocaleDateString('es-ES', {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });
  }

  function startRealClock() {
    function tick() {
      const now = new Date();
      if (!isClocked) {
        document.getElementById('clock').textContent = now.toLocaleTimeString('es-ES', { hour12: false });
      }
    }
    tick();
    setInterval(tick, 1000);
  }

  function toggleClock() {
    if (!isClocked) {
      // Clock IN
      isClocked = true;
      clockStart = new Date();
      const btn = document.getElementById('clockBtn');
      btn.classList.add('active');
      btn.querySelector('.icon').innerHTML = '&#9632;';
      document.getElementById('btnText').textContent = 'PARAR';
      document.getElementById('clockLabel').textContent = 'Trabajando...';
      document.getElementById('sessionInfo').style.display = 'flex';
      document.getElementById('sessionStart').textContent = clockStart.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });

      timerInterval = setInterval(() => {
        const diff = Date.now() - clockStart.getTime();
        const h = Math.floor(diff / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);
        document.getElementById('clock').textContent =
          String(h).padStart(2, '0') + ':' + String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
        document.getElementById('sessionDuration').textContent = h + 'h ' + m + 'min';
      }, 1000);
    } else {
      // Clock OUT
      isClocked = false;
      clearInterval(timerInterval);
      const clockEnd = new Date();
      const btn = document.getElementById('clockBtn');
      btn.classList.remove('active');
      btn.querySelector('.icon').innerHTML = '&#9654;';
      document.getElementById('btnText').textContent = 'FICHAR';
      document.getElementById('clockLabel').textContent = 'Listo para fichar';
      document.getElementById('sessionInfo').style.display = 'none';

      const entry = {
        date: clockStart.toISOString().split('T')[0],
        start: clockStart.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }),
        end: clockEnd.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }),
        minutes: Math.round((clockEnd - clockStart) / 60000),
        project: document.getElementById('projectSelect').value,
        task: document.getElementById('taskSelect').value,
        notes: document.getElementById('notesInput').value || '‚Äî',
        startISO: clockStart.toISOString(),
        endISO: clockEnd.toISOString()
      };
      entries.unshift(entry);
      localStorage.setItem('timeEntries', JSON.stringify(entries));
      document.getElementById('notesInput').value = '';

      renderLog();
      renderStats();
      renderCharts();
      renderHeatmap();
    }
  }

  function renderLog() {
    const body = document.getElementById('logBody');
    body.innerHTML = entries.slice(0, 15).map(e => {
      const h = Math.floor(e.minutes / 60);
      const m = e.minutes % 60;
      const projColors = { 'B.AI Internship': 'blue', 'Master - BG': 'purple', 'Coursera': 'orange', 'Anthropic': 'purple', 'Otro': 'green' };
      const tagClass = 'tag-' + (projColors[e.project] || 'green');
      return `<tr>
        <td>${formatDate(e.date)}</td>
        <td>${e.start}</td>
        <td>${e.end}</td>
        <td style="font-weight:600">${h}h ${m}min</td>
        <td><span class="tag ${tagClass}">${e.project}</span></td>
        <td>${e.task}</td>
        <td style="color:var(--text-muted)">${e.notes}</td>
      </tr>`;
    }).join('');
  }

  function formatDate(dateStr) {
    const d = new Date(dateStr + 'T12:00:00');
    return d.toLocaleDateString('es-ES', { day: '2-digit', month: 'short' });
  }

  function renderStats() {
    const today = new Date().toISOString().split('T')[0];
    const todayEntries = entries.filter(e => e.date === today);
    const todayMins = todayEntries.reduce((s, e) => s + e.minutes, 0);

    const weekStart = new Date();
    weekStart.setDate(weekStart.getDate() - weekStart.getDay() + 1);
    weekStart.setHours(0, 0, 0, 0);
    const weekEntries = entries.filter(e => new Date(e.date + 'T12:00:00') >= weekStart);
    const weekMins = weekEntries.reduce((s, e) => s + e.minutes, 0);

    const monthStart = new Date();
    monthStart.setDate(1);
    monthStart.setHours(0, 0, 0, 0);
    const monthEntries = entries.filter(e => new Date(e.date + 'T12:00:00') >= monthStart);
    const monthMins = monthEntries.reduce((s, e) => s + e.minutes, 0);

    const last7 = new Date();
    last7.setDate(last7.getDate() - 7);
    const last7Entries = entries.filter(e => new Date(e.date + 'T12:00:00') >= last7);
    const avgMins = last7Entries.length > 0 ? Math.round(last7Entries.reduce((s, e) => s + e.minutes, 0) / 7) : 0;

    document.getElementById('todayHours').textContent = formatHours(todayMins);
    document.getElementById('todaySessions').textContent = todayEntries.length + ' sesiones';
    document.getElementById('weekHours').textContent = formatHours(weekMins);
    document.getElementById('weekSessions').textContent = weekEntries.length + ' sesiones';
    document.getElementById('monthHours').textContent = formatHours(monthMins);
    document.getElementById('monthSessions').textContent = monthEntries.length + ' sesiones';
    document.getElementById('avgHours').textContent = formatHours(avgMins);
  }

  function formatHours(mins) {
    const h = Math.floor(mins / 60);
    const m = mins % 60;
    return m > 0 ? `${h}h ${m}m` : `${h}h`;
  }

  function renderCharts() {
    const projectMins = {};
    entries.forEach(e => {
      projectMins[e.project] = (projectMins[e.project] || 0) + e.minutes;
    });
    const maxMins = Math.max(...Object.values(projectMins), 1);
    const colors = {
      'B.AI Internship': 'var(--blue)',
      'Master - BG': 'var(--pink)',
      'Coursera': 'var(--orange)',
      'Anthropic': 'var(--purple)',
      'Otro': 'var(--text-muted)'
    };

    const chart = document.getElementById('projectChart');
    chart.innerHTML = Object.entries(projectMins)
      .sort((a, b) => b[1] - a[1])
      .map(([name, mins]) => {
        const pct = (mins / maxMins * 100).toFixed(0);
        const color = colors[name] || 'var(--accent)';
        return `<div class="bar-row">
          <div class="bar-label">${name}</div>
          <div class="bar-track">
            <div class="bar-fill" style="width:${pct}%;background:${color}">${formatHours(mins)}</div>
          </div>
        </div>`;
      }).join('') || '<div style="color:var(--text-muted);text-align:center;padding:20px">Sin datos todavia</div>';
  }

  function renderHeatmap() {
    const days = ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'];
    const heatmap = document.getElementById('weekHeatmap');
    const now = new Date();
    const monday = new Date(now);
    monday.setDate(now.getDate() - ((now.getDay() + 6) % 7));
    monday.setHours(0, 0, 0, 0);

    let cells = '';
    for (let i = 0; i < 7; i++) {
      const d = new Date(monday);
      d.setDate(d.getDate() + i);
      const dateStr = d.toISOString().split('T')[0];
      const dayMins = entries.filter(e => e.date === dateStr).reduce((s, e) => s + e.minutes, 0);
      const h = Math.floor(dayMins / 60);
      const intensity = Math.min(dayMins / 480, 1);
      const bg = dayMins > 0
        ? `rgba(99,102,241,${0.1 + intensity * 0.4})`
        : 'var(--surface2)';
      const isToday = dateStr === now.toISOString().split('T')[0];
      const border = isToday ? 'border: 2px solid var(--accent);' : '';
      cells += `<div class="heat-day" style="background:${bg};${border}">
        <span class="day-name">${days[i]}</span>
        <span class="day-hours">${dayMins > 0 ? h + 'h' : '-'}</span>
      </div>`;
    }
    heatmap.innerHTML = cells;
  }

  function exportCSV() {
    if (entries.length === 0) return alert('No hay datos para exportar');
    const headers = 'Fecha,Inicio,Fin,Minutos,Horas,Proyecto,Tarea,Notas\n';
    const rows = entries.map(e =>
      `${e.date},${e.start},${e.end},${e.minutes},${(e.minutes/60).toFixed(2)},${e.project},${e.task},"${e.notes}"`
    ).join('\n');
    const blob = new Blob([headers + rows], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'registro_horas_' + new Date().toISOString().split('T')[0] + '.csv';
    link.click();
  }

  init();
</script>
</body>
</html>
